<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>JS.Anim.N1</title>
    <script src="object.js"></script>
</head>
<body>

        <section>
                <canvas id='canvas' width='500' height='600'> </canvas>
        </section>
    


<script>
'use strict';
var $ = function (foo) {
    return document.getElementById(foo);    // save keystrokes
}

//Random color
function getRandomColor() {
    var letters = '0123456789ABCDEF';
    var color = '#';
    for (var i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
}

//Objekter
 let Umo = {
    init(canvas, color) {
        this.canvas = canvas;
        this.x = Math.random() * this.canvas.getWidth();
        this.y = Math.random() * this.canvas.getHeight();
        this.r = Math.random() * 9 + 3;
        this.dx = Math.random() * 5;
        this.dy = Math.random() * 5;
        this.color = color;
    },

    firkant(canvas, color) {
        this.canvas = canvas;
        this.x = Math.random() * this.canvas.getWidth();
        this.y = Math.random() * this.canvas.getHeight();
        this.w = 20;
        this.h = 20;
        this.fr = Math.sqrt(Math.pow(this.w, 2) + Math.pow(this.h, 2));
        this.dx = Math.random() * 5;
        this.dy = Math.random() * 5;
        this.color = color;
    },

    draw() {
        this.canvas.getContext().beginPath();
        this.canvas.getContext().fillStyle = this.color;
        this.canvas.getContext().arc(this.x, this.y, this.r, 0, Math.PI * 2, false);
        this.canvas.getContext().fillRect(this.x, this.y, this.w, this.h);
        this.canvas.getContext().fill();
        this.canvas.getContext().closePath();
    },

    move() {//Bevæger sig
        
        for (let j = 0; j < shapes.length; j++){
            if(shapes[j].r){ //Rammer den en cirkel
                //ounce
                if (this.x + this.dx > this.canvas.getWidth() || this.x + this.dx < 0)
                    this.dx = -this.dx;
                if (this.y + this.dy > this.canvas.getHeight() || this.y + this.dy < 0)
                    this.dy = -this.dy;

                } else { //Rammer den kanten, skal den skubbes væk
                    if(shapes[j].x + shapes[j].w > this.canvas.getWidth()) {
                        //bounce
                        let dis = shapes[j].x + shapes[j].w;
                        let newDis = dis - this.canvas.getWidth();
                        shapes[j].x = shapes[j].x - newDis;
                        this.dx = -this.dx;
                    }
                    if(shapes[j].y + shapes[j].h > this.canvas.getHeight()) {
                        //bounce
                        let dis = shapes[j].y + shapes[j].h;
                        let newDis = dis - this.canvas.getHeight();
                        shapes[j].y = shapes[j].y - newDis;
                        this.dy = -this.dy;
                    }
                }
                this.x += this.dx;
                this.y += this.dy;
            }
        
      
        //Testen hvor de rammer hinanden
        for (let j = 0; j < shapes.length; j++){
            if (this === shapes[j]) {
                continue;
            } else {
                if (this.hitTest(shapes[j])) { //Hvis den rammer skal den udregne arealet
                    let a1 = this.grow();
                    let a2 = shapes[j].grow();
                    a1 += a2;
                    a1 /= Math.PI;
                    a1 = Math.sqrt(a1);
                    if (this.r >= shapes[j].r) { //er radius større eller lig med, så skal de spises
                        this.r = a1;
                        shapes.splice(j, 1);
                    } else { //ellers skal de bare være der
                        shapes[j].r = a1;
                    }
                }
            }
        }
        if (shapes.length === 1) {
            //clearInterval(onoff);
            this.clear();
            window.alert('Alle bolde er nu spist');
        }
    },
    grow() {
        for (let j = 0; j < shapes.length; j++){
            if(shapes[j].r){ //cirkel
                return Math.PI * this.r * this.r;
            } else { //firkant
                return Math.PI * this.fr * this.fr;
            }
        }
    },
    hitTest(obj){ //Rammer den?
        let rum = Math.sqrt(Math.pow(this.x - obj.x, 2) + Math.pow(this.y - obj.y, 2));

        if(rum <= this.r + obj.r){
            return true;
        }else{
            return false;
        }
    },

    toString() {
        s = '';
        s += this.x + ':' + this.y + ', ' + this.r + " \n " + this.color;
        console.log(s);
    }
};

//tegner dem
var redraw = function () {
    canvas.clear();     // clear canvas
    canvas.prep();      // prep canvas with background color
    for (let umo of shapes) {
        umo.move();  // change coordinates
        umo.draw();  // draw again with new coordinates
    }
};

var repeater = function () {
    setInterval(redraw, 100);
};


//laver cirklerne
var initialize = function () {
    canvas = Object.create(Canvas);
    canvas.init('canvas', '#F3F6FE');//transparent

    //cirkel
    let c0 = Object.create(Umo);
    c0.init(canvas, getRandomColor());
    shapes.push(c0);

    c0 = Object.create(Umo);
    c0.init(canvas, getRandomColor());
    shapes.push(c0);

    c0 = Object.create(Umo);
    c0.init(canvas, getRandomColor());
    shapes.push(c0);

    c0 = Object.create(Umo);
    c0.init(canvas, getRandomColor());
    shapes.push(c0);

    c0 = Object.create(Umo);
    c0.init(canvas, getRandomColor());
    shapes.push(c0);

    //firkant
    let c1 = Object.create(Umo);
    c1.firkant(canvas, getRandomColor());
    shapes.push(c1);

    c1 = Object.create(Umo);
    c1.firkant(canvas, getRandomColor());
    shapes.push(c1);

    c1 = Object.create(Umo);
    c1.firkant(canvas, getRandomColor());
    shapes.push(c1);

    c1 = Object.create(Umo);
    c1.firkant(canvas, getRandomColor());
    shapes.push(c1);

    c1 = Object.create(Umo);
    c1.firkant(canvas, getRandomColor());
    shapes.push(c1);

    repeater();
};



var shapes = [];
var canvas;


var nml = window.addEventListener('load', initialize, false);
        
    
    
</script>
</body>
</html>